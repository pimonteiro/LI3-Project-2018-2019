\documentclass[letterpaper, 10 pt, conference]{IEEEtran}  % Comment this line out
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}                                                         % if you need a4paper
\usepackage[portuges]{babel}
%\documentclass[a4paper, 10pt, conference]{ieeeconf}      % Use this line for a4
\usepackage{listings}
\lstset { %
language=Java,
}                                                         % paper
\usepackage{tikz}
\usepackage{xstring}
\usetikzlibrary{calc, arrows}
\usetikzlibrary{matrix,positioning,arrows.meta,arrows}

\tikzset{
mymat/.style={
matrix of math nodes,
text height=2.5ex,
text depth=0.75ex,
text width=3.25ex,
align=center,
column sep=-\pgflinewidth
},
mymats/.style={
mymat,
nodes={draw,fill=#1}
}
}
\IEEEoverridecommandlockouts                              % This command is only
                                                      % needed if you want to
                                                      % use the \thanks command
\overrideIEEEmargins
% See the \addtolength command later in the file to balance the column lengths
% on the last page of the document



% The following packages can be found on http:\\www.ctan.org
%\usepackage{graphics} % for pdf, bitmapped graphics files
%\usepackage{epsfig} % for postscript graphics files
%\usepackage{mathptmx} % assumes new font selection scheme installed
%\usepackage{times} % assumes new font selection scheme installed
%\usepackage{amsmath} % assumes amsmath package installed
%\usepackage{amssymb}  % assumes amsmath package installed

\title{\LARGE \bf
Laboratórios de Informática III - Projecto em Java
}

%\author{ \parbox{3 in}{\centering Huibert Kwakernaak*
%         \thanks{*Use the $\backslash$thanks command to put information here}\\
%         Faculty of Electrical Engineering, Mathematics and Computer Science\\
%         University of Twente\\
%         7500 AE Enschede, The Netherlands\\
%         {\tt\small h.kwakernaak@autsubmit.com}}
%         \hspace*{ 0.5 in}
%         \parbox{3 in}{ \centering Pradeep Misra**
%         \thanks{**The footnote marks may be inserted manually}\\
%        Department of Electrical Engineering \\
%         Wright State University\\
%         Dayton, OH 45435, USA\\
%         {\tt\small pmisra@cs.wright.edu}}
%}

\author{Adriana Meireles (a82582), Eduardo Jorge Barbosa (a83344), Filipe Monteiro (a80229)% <-this % stops a space
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}



\maketitle
\thispagestyle{empty}
\pagestyle{empty}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{abstract}

Este trabalho prático teve como objectivo replicar o anterior projeto (aplicado em C) mas agora em Java - a organização de grandes volumes de dados de forma a responder a questões, pré definidas, em tempo útil. Os objectos de estudo foram vários dumps do \textit{Stack Exchange}.

\end{abstract}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{INTRODUÇÃO}

Neste relatório iremos falar sobre a realização da 2ª fase do trabalho de laboratórios de informática III.
É semelhante ao trabalho realizado na primeira fase, à exceção que este é feito em \textit{Java}.
\newline
O fundamental deste trabalho prático consistiu em converter as estruturas e querys existentes ,construídas no projeto anterior ,em estruturas mais dinâmicas, de mais flexibilidade e portabilidade, assim como melhoras de desempenho por parte de \textit{features} existentes na linguagem de programação Java.
\newline
Abordaremos a estrutura utilizada, a maneira como chegamos à solução e os diferentes caminhos que percorremos para tentar minimizar o tempo de execução, bem como as dificuldades que foram surgindo.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Parser}

Como o parse usado na primeira fase foi desenvolvido para \textit{Java},escolheu-se mais uma vez utilizar o parser do tipo \textit{SAX}. Este parser é orientado a eventos e recomendado pela documentação do \textit{libxml} para dar parse a grandes ficheiros.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Modularidade}
A estrutura do \textit{package} engine tem o seguinte diagrama:



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Classes e Estrutura}

\subsection{MAIN STRUCT}
Tal como no projeto em C, a estrutura principal é constituida por 3 HashMaps, uma para os perfis, outra para posts e outra para tags, e ainda a reformulado Tardis que contem os posts todos organizados pelo critério \textit{x}.
\newline
Temos assim as seguintes variáveis de instância:
\begin{lstlisting}
private HashMap<Long,Profile> profiles;
private HashMap<Long,Post> posts;
private HashMap<String,Long> tags;
private Tardis tardis64;
\end{lstlisting}

\subsection{USER}

Na Class de um Utilizador existem, entre os dados pessoais (nome, bio, ID,reputação) uma TreeSet de Posts
pertencentes ao utilizador (ordenados naturalmente do mais recente - mais antigo).
É composta pelas seguintes variáveis:

\begin{lstlisting}
public class Profile {

    private TreeSet<Post> posts;
    private String about_me;
    private String name;
    private long n_posts;
    private long id;
    private int reputation;

}
\end{lstlisting}

Nesta foram implementados apenas os métodos básicos (construtores, gets, sets, clone, toString).

\subsection{POST, QUESTION, ANSWER}

A Class Post é uma Class Abstracta de onde duas classes extendem: Question e Answer.
Foi utilizada uma class Abstrata para podermos tratar destas duas subclasses como se fossem
"do mesmo tipo", facilitando assim o uso destas.

\begin{lstlisting}
public abstract class Post implements Comparable<Post> {

    private long id;
    private LocalDateTime creation_date;
    private long owner_id;
    private long score;
    private long n_comments;

}
public class Question extends Post {

    private Map<Long,Answer> answers;
    private String title;
    private String tags;
    private long n_answers;

}

public class Answer extends Post {

    private long parent_id;

}
\end{lstlisting}

\subsection{TARDIS}

\subsection{COMPARATORS --- EXCEPÇÕES}

Para comparadores, temos as seguintes:
\begin{itemize}
    \item \item PostCreationDateComparator --> Compara dois Posts em relação á sua data de criação, de forma \textbf{descendente};
    \item ProfileNPostsComparator --> Compara dois Utilizadores em relacão ao número de posts, de forma \textbf{descendente};
    \item AnwserScoreComparator --> Compara duas Answer em relação ao seu score, de forma \textbf{descendente};
    \item QuestionCreationDateComparator --> Compara duas Question em relação á sua data de criação, de forma \textbf{descendente}.
\end{itemize}


Quanto a excepções, criamos as seguintes:
\begin{itemize}
     \item NoPostFoundException --> Caso um ID nao exista entre os Posts;
     \item NoProfileFoundException --> Caso um ID nao exista entre os Perfis;
     \item NoTagFoundException --> Caso um ID nao exista entre as Tags;
     \item PostIsNotOfRightTypeException --> Caso uma query exiga algo sobre um tipo de Post, mas recebe outro.
\end{itemize}

\section{Conclusão}

Esta segunda fase do projeto deu para aprender como deve ser feito um trabalho em Java onde devemos conseguir o menor tempo de execução.Tal como em C, devem ser implementadas estruturas eficientes,guardar apenas o necessário e não fazer cópias desnecessárias.
\newline
Em comparação à primeira fase, esta foi mais fácil.Não tivemos que criar tabelas de Hash ou listas ligadas,visto que o Java contém muitas estruturas pré definidas eficientes e relativamente mais fáceis de usar.Também não houve necessidade de libertar memória alocada, visto que o garbage collector faz isso por nós.
\newline
Também podemos aprender a usar streams do Java 8, apesar de serem ligeiramente mais lentas que os iteradores externos,tornam o código mais compacto,facilitando a leitura e o debug.
\newline
Tal como na primeira fase,consideramos que cumprimos os objetivos pretendidos.






%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{ESTRUTURAÇÃO DE QUERYS}

\subsection{QUERY1}

Nesta query começamos por verificar o tipo do \textit{Post} pedido. Caso seja uma \textit{Answer} vais buscar a informação
á \textit{Question} a que pertence, caso contrário vai diretamente a esta.
É importante referir que alteramos a interface \negrito{TADCommunity}, colocando na assinatura desta query a
possbilidade de produzir \negrito{excepções} caso: nao haja o Post ou o utilizador a que pertence a Question não exista.


\subsection{QUERY2}

Aqui inserimos todos os perfis existentes na estrutura principal num TreeSet, usando o comparador \textit{ProfileNPostsComparator}
que ordena perfis consoante o nº de posts deste(descendente). Depois retorna apenas os primeiros N
perfis, sobre a forma de uma lista de longs (usando streams, maps e limites).

\subsection{QUERY3}

Como a nossa estrutura Tardis possui um método que retorna todos os Posts existentes no programa, apenas chamamos esse método,
retornando um par apenas com o tamanho de cada tipo de Post(Question e Answer).

\subsection{QUERY4}

Nesta query começamos por recolher todas as Question entre as datas pedidas, através da Tardis(ordenadas por data).
Depois retornamos uma lista com o ID de todas as Question da Tardis.
\newline
É importante referir que experimentamos a implementação com iteradores externos e internos, estando os resultados mais á frente
no relatório.

\subsection{QUERY5}

Aqui acedemos ao HashMap da estrutura principal para receber o Profile com o ID passado. Depois retornamos um par com a bio deste Profile e os
10 posts mais recentes(através do TreeSet<Post> existente no Profile, apenas pegando os 10 primeiros).
Fizemos também a experiência de ir buscar os 10 últimos posts deste (sendo os 10 primeiros no TreeSet do Profile) com
iteradores internos e externos, mais á frente apresenando resultados.

\subsection{QUERY6}

Usando a Tardis para ter todas as Anwsers entre as datas pretendidas, ordenadas por um comparator \textint{AnswerScoreComparator}
que ordena por score (votos - descendente). Depois usamos um iterador externo para percorrer apenas as primeiras N Anwser ordenadas.

\subsection{QUERY7}

TODO

\subsection{QUERY8}

Percorrendo todas as Question (que possuem título), recorrendo á Tardis, adicionamos as primeiras N Question ID onde a palavra
existe no título(usando iteradores externos).

\subsection{QUERY9}

Nesta query pegamos em todos os Post do primeiro utilizador passado e fazemos o seguinte flow:
\begin{itemize}
    \item Se o Post for uma Answer, verificamos se a Question a que pertence a resposta pertence ao segundo utiizador. Se sim,
    inserimos num TreeSet ordenado por data(PostCreationDateComparator) caso ainda não exista neste;
    \item Se for uma Question, percorremos todas as respostas, verificando se alguma pertence ao segundo utilizador. Se sim, inserimos
    no TreeSet caso ainda nao exista.
\end{itemize}
    Importante referir que: não vale a pena continuar a percorrer as respostas ou questoes quando já se encontrou algo em comum.


\subsection{QUERY10}

Nesta começamos por ir buscar o Post a que pertence o ID. Se não for uma Question atira uma excepção \textit{PostIsNotOfRightType}
, indicando que não se pode obter as respostas de uma reposta.
Depois percorremos cada resposta, calculando o score desta e atribuindo a um par constituido por este e pelo ID da resposta.
Caso algum score seja superior ao existente no par, atualiza-se este, retornando no fim a parte do par com o ID da reposta.
Para facilitar, criamos um metodo que calcula o score de uma Anwser.

\subsection{QUERY11}

TODO













%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\addtolength{\textheight}{-12cm}   % This command serves to balance the column lengths
                              % on the last page of the document manually. It shortens
                              % the textheight of the last page by a suitable amount.
                              % This command does not take effect until the next page
                              % so it should come on the page before the last. Make
                              % sure that you do not shorten the textheight too much.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\section*{APPENDIX}

%Appendixes should appear before the acknowledgment.

%\section*{ACKNOWLEDGMENT}

%The preferred spelling of the word ÒacknowledgmentÓ in America is without an ÒeÓ after the ÒgÓ. Avoid the stilted expression, ÒOne of us (R. B. G.) thanks . . .Ó  Instead, try ÒR. B. G. thanksÓ. Put sponsor acknowledgments in the unnumbered footnote on the first page.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%References are important to the reader; therefore, each citation must be complete and correct. If at all possible, references should be commonly available publications.



%\begin{thebibliography}{99}
%\bibitem{c1} G. O. Young, ÒSynthetic structure of industrial plastics (Book style with paper title and editor),Ó    in Plastics, 2nd ed. vol. 3, J. Peters, Ed.  New York: McGraw-Hill, 1964, pp. 15Ð64.
%\bibitem{c2} W.-K. Chen, Linear Networks and Systems (Book style).  Belmont, CA: Wadsworth, 1993, pp. 123Ð135.

%\end{thebibliography}
\end{document}
